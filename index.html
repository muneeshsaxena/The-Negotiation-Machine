<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>Negotiation Dashboard – Colorful (Complete)</title> <script src="https://cdn.tailwindcss.com"></script> <style> html, body { height: 100%; margin: 0; } @media print { .print-dump { display: block !important; break-inside: avoid; page-break-inside: avoid; } .screen-only { display: none !important; } .print-only { display: block !important; } body { background: #ffffff !important; color: #000000 !important; } } .print-only { display: none; } .print-dump { display: none; } #fatal { position: fixed; inset: 0; background: #141427; color: #fff; display: none; align-items: center; justify-content: center; padding: 24px; z-index: 99999; } #fatal .box { max-width: 900px; width: 100%; background: #1e1e2f; border-radius: 12px; border: 1px solid #444; padding: 16px 20px; font-family: ui-sans-serif, system-ui; } #fatal .title { font-weight: 700; font-size: 18px; margin-bottom: 6px; color: #fca5a5; } #fatal .msg { font-size: 14px; opacity: 0.9; white-space: pre-wrap; } </style> </head> <body class="min-h-screen bg-[#0c1027] text-white"> <div id="root"></div> <div id="fatal"> <div class="box"> <div class="title">A script error occurred</div> <div id="fatal-msg" class="msg"></div> </div> </div> <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script> <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script> <script> (function loadFramerMotion(){ function alias(){ if (!window.framerMotion && window.FramerMotion) window.framerMotion = window.FramerMotion; } var s = document.createElement('script'); s.src = 'https://cdn.jsdelivr.net/npm/framer-motion@11/dist/framer-motion.umd.js'; s.crossOrigin = 'anonymous'; s.onload = alias; s.onerror = function(){ var f = document.createElement('script'); f.src = 'https://unpkg.com/framer-motion@11.0.0/dist/framer-motion.umd.js'; f.crossOrigin = 'anonymous'; f.onload = alias; document.head.appendChild(f); }; document.head.appendChild(s); })(); </script> <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script> <script src="https://unpkg.com/@babel/standalone@7.26.3/babel.min.js"></script> <script type="text/babel" data-presets="env,react"> const { useState, useRef, useEffect, useLayoutEffect, useCallback } = React; const THEME = { panelA: "#000000", panelB: "#000000", panelC: "#b8b8b8", cream: "#f8f8f8", blue: "#3b5998", green: "#4b7b4b", pink: "#b56576", orange: "#d49a6a", violet: "#6a5acd", ink: "#000000", ink2: "#222222", dark: "#000000", mid: "#999999", light: "#efefef" }; function showFatal(msg){ const box = document.getElementById('fatal'); const m = document.getElementById('fatal-msg'); if (box && m){ box.style.display = 'flex'; m.textContent = msg; } } function ensureFramerReady(maxWaitMs = 3500) { const start = Date.now(); return new Promise((resolve, reject) => { (function check(){ const fm = window.framerMotion || window.FramerMotion; if (fm && fm.motion) return resolve(fm); if (Date.now() - start > maxWaitMs) return reject(new Error('Framer Motion failed to load (timeout)')); setTimeout(check, 40); })(); }); } ensureFramerReady() .then((fm) => { startApp(fm.motion, false); }) .catch((err) => { console.warn('Framer Motion failed; enabling no-animations shim:', err); function createMotion(tag){ return React.forwardRef((props, ref) => { const { initial, animate, exit, whileTap, whileHover, transition, variants, layout, layoutId, ...rest } = props || {}; return React.createElement(tag, { ...rest, ref }, props && props.children); }); } const motionShim = new Proxy({}, { get: (_, tag) => createMotion(tag) }); window.framerMotion = { motion: motionShim }; startApp(motionShim, true); }); function startApp(motion, noAnimMode) { if (!motion) { showFatal('motion component unavailable'); return; } function useStrategyData(initial){ const [stages, setStages] = React.useState(initial); const updateStage = (i, patch) => setStages(prev => prev.map((s, idx) => (idx === i ? { ...s, ...patch } : s))); const renameSub = (i, oldKey, newKey) => setStages(prev => prev.map((s, idx) => { if (idx !== i) return s; const name = (newKey || "").trim(); if (!name || name === oldKey) return s; const subsObj = s.subs || {}; if (!(oldKey in subsObj)) return s; const entries = Object.entries(subsObj); const pos = entries.findIndex(([k]) => k === oldKey); if (pos === -1) return s; if (entries.some(([k]) => k === name && k !== oldKey)) return s; entries[pos] = [name, entries[pos][1]]; const subs = {}; for (let j = 0; j < entries.length; j++) { const [k, v] = entries[j]; subs[k] = v; } return { ...s, subs }; })); const updateSubItems = (i, key, items) => setStages(prev => prev.map((s, idx) => (idx === i ? { ...s, subs: { ...s.subs, [key]: items } } : s))); return { stages, setStages, updateStage, renameSub, updateSubItems }; } function StrategyEditor({ stages, updateStage, renameSub, updateSubItems }){ const COLORS = [ { bg: 'linear-gradient(135deg,#ffe7ec 0%,#ffd1dc 100%)', chip: '#e66a7b' }, { bg: 'linear-gradient(135deg,#e4f2ff 0%,#cfe8ff 100%)', chip: '#3b82f6' }, { bg: 'linear-gradient(135deg,#e7ffe9 0%,#d4ffd8 100%)', chip: '#16a34a' }, { bg: 'linear-gradient(135deg,#fff7e6 0%,#ffe9c7 100%)', chip: '#f59e0b' }, { bg: 'linear-gradient(135deg,#efe7ff 0%,#e0d4ff 100%)', chip: '#7c3aed' }, { bg: 'linear-gradient(135deg,#e6fffb 0%,#c7fff6 100%)', chip: '#0ea5a4' }, { bg: 'linear-gradient(135deg,#fff0f5 0%,#ffd6e7 100%)', chip: '#ec4899' }, { bg: 'linear-gradient(135deg,#f0fff4 0%,#d9fce5 100%)', chip: '#22c55e' }, { bg: 'linear-gradient(135deg,#f0f9ff 0%,#e0f2fe 100%)', chip: '#0284c7' }, { bg: 'linear-gradient(135deg,#fefce8 0%,#fef3c7 100%)', chip: '#ca8a04' }, ]; const [activeStage, setActiveStage] = React.useState(0); const stage = stages[activeStage] || { k: '', t: '', subs: {} }; const subKeys = Object.keys(stage.subs || {}); const [activeSub, setActiveSub] = React.useState(0); React.useEffect(() => { if (activeStage >= stages.length) setActiveStage(0); }, [stages.length, activeStage]); React.useEffect(() => { if (activeSub >= subKeys.length) setActiveSub(0); }, [subKeys.length, activeSub]); return ( <div className="w-full max-w-6xl mx-auto p-4 text-black"> <div className="mb-4 flex flex-wrap gap-2"> {stages.map((st, i) => ( <button key={i} type="button" onClick={() => { setActiveStage(i); setActiveSub(0); }} className="px-3 py-1.5 rounded-lg text-sm font-semibold border" style={ i === activeStage ? { background: '#2d3748', color: '#fff', borderColor: '#2d3748' } : { background: '#ffffff', color: '#374151', borderColor: '#cbd5e1' } } > {st.k || `Stage ${i+1}`} </button> ))} </div> <div className="mb-5 rounded-2xl border shadow-sm overflow-hidden"> <div className="grid md:grid-cols-2 gap-3 p-4" style={{ background: '#f8fafc' }}> <input value={stage.k} onChange={(e) => updateStage(activeStage, { k: e.target.value })} className="w-full rounded-lg border px-3 py-2 font-semibold" placeholder="Stage Title" /> <textarea value={stage.t} onChange={(e) => updateStage(activeStage, { t: e.target.value })} className="w-full rounded-lg border px-3 py-2" placeholder="Stage description" rows={2} /> </div> </div> <div className="mb-3 flex flex-wrap gap-2"> {subKeys.map((k, i) => ( <button key={k} type="button" onClick={() => setActiveSub(i)} className="px-3 py-1.5 rounded-md text-xs font-semibold border" style={ i === activeSub ? { background: COLORS[i % COLORS.length].chip, color: '#fff', borderColor: COLORS[i % COLORS.length].chip } : { background: '#ffffff', color: '#374151', borderColor: '#cbd5e1' } } > {k} </button> ))} </div> {subKeys.length > 0 && ( <div className="rounded-2xl border shadow-sm overflow-hidden" style={{ background: COLORS[activeSub % COLORS.length].bg }}> <div className="p-3 md:p-4 border-b" style={{ borderColor: 'rgba(0,0,0,0.08)' }}> <input defaultValue={subKeys[activeSub]} onBlur={(e) => renameSub(activeStage, subKeys[activeSub], e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter') e.currentTarget.blur(); if (e.key === 'Escape') { e.currentTarget.value = subKeys[activeSub]; e.currentTarget.blur(); } }} className="w-full rounded-md border px-3 py-2 font-semibold bg-white/80 backdrop-blur" placeholder="Sub-heading" /> </div> <div className="p-3 md:p-4"> <textarea id="sub-editor" value={(stage.subs[subKeys[activeSub]] || []).join('\n')} onChange={(e) => { const lines = e.target.value.split(/\r?\n/); updateSubItems(activeStage, subKeys[activeSub], lines); }} className="w-full rounded-md border px-3 py-2 text-sm bg-white/90 backdrop-blur" rows={8} placeholder="One bullet per line" /> </div> </div> )} </div> ); } function NegotiationMachineRetroTV({ stages, goalsTabs, setGoalsTabs, onExportJSON, onStartImportJSON }) { const { motion } = window.framerMotion; const [idx, setIdx] = React.useState(0); const [subIdx, setSubIdx] = React.useState(0); const [activeGoalsTab, setActiveGoalsTab] = React.useState(0); const tabInfoTexts = [ '(1) - Identify type of Negotiation / Opening statement', '(2) - BATNA Analysis (calculate ZOPA and reservation value)', '(3) - Stakeholders and Power mapping / Situational Matrix based on (Shell,1999)', '(4) - Team selection and Roles during Negotiation', '(5) - Tabulate the Goals & Success criteria)', '(6) - Interest Matrix & Assumptions', '(7) - Value Creation Opportunities', '(8) - Relations at Play / Risk Analysis / Red lines for the negotiation', '(9) - Assess your leverage', ]; React.useEffect(() => { window.__tabInfoTexts = tabInfoTexts; return () => { delete window.__tabInfoTexts; }; }, []); if (!stages || stages.length === 0) { return ( <div className="min-h-[40vh] w-full flex items-center justify-center bg-[#F5F3E7] p-6 rounded-2xl"> <p className="text-[#2c2c40] text-center">No Strategy Data found. Add content in STRATEGY DATA to begin.</p> </div> ); } const currentStage = stages[idx % stages.length]; const subKeys = Object.keys(currentStage.subs || {}); React.useEffect(() => { if (subIdx >= subKeys.length) setSubIdx(0); }, [subKeys.length, subIdx]); const currentSub = subKeys[subIdx % Math.max(1, subKeys.length)]; const subItems = (currentStage.subs || {})[currentSub] || []; const mainTickCount = stages.length; const subTickCount = subKeys.length || 1; const baseAngle = -90; const [animatedMainAngle, setAnimatedMainAngle] = React.useState(baseAngle); const [animatedSubAngle, setAnimatedSubAngle] = React.useState(baseAngle); const shortestStep = (current, target) => { const delta = ((target - current + 540) % 360) - 180; return current + delta; }; React.useEffect(() => { const target = baseAngle + (360 / mainTickCount) * (idx % mainTickCount); setAnimatedMainAngle((cur) => shortestStep(cur, target)); }, [idx, mainTickCount]); React.useEffect(() => { const target = baseAngle + (360 / subTickCount) * (subIdx % subTickCount); setAnimatedSubAngle((cur) => shortestStep(cur, target)); }, [subIdx, subTickCount]); const next = () => setIdx((p) => (p + 1) % mainTickCount); const prev = () => setIdx((p) => (p - 1 + mainTickCount) % mainTickCount); const nextSub = () => setSubIdx((p) => (p + 1) % subTickCount); const prevSub = () => setSubIdx((p) => (p - 1 + subTickCount) % subTickCount); const exportRef = React.useRef(null); const handleExportPDF = React.useCallback(async () => { if (!window.jspdf || !window.jspdf.jsPDF) { alert('PDF library failed to load'); return; } const { jsPDF } = window.jspdf; const pdf = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' }); const C = { headerBg: [18, 36, 59], headerText: [255, 255, 255], titleText: [18, 36, 59], bodyText: [26, 26, 26], panelBg: [247, 249, 252], accent: [26, 141, 162], rule: [210, 216, 222], footerText: [90, 100, 110] }; const margin = 48; const pageW = pdf.internal.pageSize.getWidth(); const pageH = pdf.internal.pageSize.getHeight(); const maxW = pageW - margin * 2; const lineH = 14; function drawHeader() { pdf.setFillColor(...C.headerBg); pdf.rect(0, 0, pageW, 64, 'F'); const title = 'Negotiation - Tactical Plan'; const subtitle = 'This is the consolidated tactical plan basis the information entered in the dashboard tabs'; pdf.setTextColor(...C.headerText); pdf.setFont('helvetica', 'bold'); pdf.setFontSize(14); const tw = pdf.getTextWidth(title); pdf.text(title, (pageW - tw) / 2, 34); pdf.setFont('helvetica', 'normal'); pdf.setFontSize(10); const sw = pdf.getTextWidth(subtitle); pdf.text(subtitle, (pageW - sw) / 2, 50); } function drawFooter(pageNo) { pdf.setDrawColor(...C.rule); pdf.setLineWidth(0.6); pdf.line(margin, pageH - 34, pageW - margin, pageH - 34); pdf.setTextColor(...C.footerText); pdf.setFont('helvetica', 'normal'); pdf.setFontSize(9); const ts = new Date(); const pad = n => String(n).padStart(2, '0'); const mon = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']; const stamp = `${pad(ts.getDate())} ${mon[ts.getMonth()]} ${ts.getFullYear()}, ${pad(ts.getHours())}:${pad(ts.getMinutes())}`; pdf.text('Prepared for internal use', margin, pageH - 18); const right = `Generated: ${stamp} • Page ${pageNo}`; pdf.text(right, pageW - margin - pdf.getTextWidth(right), pageH - 18); } function wrap(text, width) { const body = (text && text.trim()) ? text : '(no notes entered)'; return pdf.splitTextToSize(body, width); } function addPanel(title, text, yStart, pageNoRef) { const innerPad = 10, accentW = 4; pdf.setFont('helvetica', 'normal'); pdf.setFontSize(11); const bodyLines = wrap(text, maxW - innerPad * 2 - accentW - 2); const titleH = 16; const blockH = innerPad + titleH + 6 + bodyLines.length * lineH + innerPad; if (yStart + blockH > pageH - 40) { drawFooter(pageNoRef.no); pdf.addPage('a4', 'portrait'); pageNoRef.no += 1; drawHeader(); yStart = 64 + 18; } pdf.setFillColor(...C.panelBg); if (pdf.roundedRect) pdf.roundedRect(margin, yStart, maxW, blockH, 6, 6, 'F'); else pdf.rect(margin, yStart, maxW, blockH, 'F'); pdf.setFillColor(...C.accent); pdf.rect(margin, yStart, accentW, blockH, 'F'); pdf.setTextColor(...C.titleText); pdf.setFont('helvetica', 'bold'); pdf.setFontSize(12); pdf.text(title, margin + accentW + innerPad, yStart + innerPad + 12); pdf.setDrawColor(...C.rule); pdf.setLineWidth(0.6); pdf.line(margin + accentW + innerPad, yStart + innerPad + 18, margin + maxW - innerPad, yStart + innerPad + 18); pdf.setTextColor(...C.bodyText); pdf.setFont('helvetica', 'normal'); pdf.setFontSize(11); let yy = yStart + innerPad + 18 + 8; for (const ln of bodyLines) { if (yy > pageH - 40) { drawFooter(pageNoRef.no); pdf.addPage('a4', 'portrait'); pageNoRef.no += 1; drawHeader(); yy = 64 + 18 + innerPad + 18 + 8; } pdf.text(ln, margin + accentW + innerPad, yy); yy += lineH; } return yStart + blockH + 10; } let pageNoRef = { no: 1 }; drawHeader(); let y = 64 + 18; for (let i = 0; i < 9; i++) { const raw = (typeof tabInfoTexts !== 'undefined' && tabInfoTexts[i]) ? String(tabInfoTexts[i]).trim() : `Tab ${i + 1}`; const panelTitle = raw.length ? raw : `Tab ${i + 1}`; const text = goalsTabs[i] || ''; y = addPanel(panelTitle, text, y, pageNoRef); } drawFooter(pageNoRef.no); pdf.save('negotiation_tabs_plus_screenshot.pdf'); }, [goalsTabs]); const mainDialRef = React.useRef(null); const subDialRef = React.useRef(null); const [radii, setRadii] = React.useState({ main: 0, sub: 0 }); React.useLayoutEffect(() => { if (!('ResizeObserver' in window)) return; const ro = new ResizeObserver(() => { const m = mainDialRef.current?.getBoundingClientRect(); const s = subDialRef.current?.getBoundingClientRect(); setRadii({ main: m ? Math.min(m.width, m.height) / 2 : 0, sub: s ? Math.min(s.width, s.height) / 2 : 0 }); }); if (mainDialRef.current) ro.observe(mainDialRef.current); if (subDialRef.current) ro.observe(subDialRef.current); return () => ro.disconnect(); }, []); const borderWidth = 6; const desiredInset = 18; const tickDistance = (dial, h) => { const r = dial === 'main' ? radii.main : radii.sub; if (!r) return 0; return r - borderWidth - desiredInset - h / 2; }; return ( <div className="min-h-[70vh] w-full flex items-center justify-center bg-[#EAE7D6] p-6"> <div ref={exportRef} className="relative w-[1100px] max-w-[96vw] rounded-[32px] shadow-2xl" style={{ background: 'linear-gradient(145deg,#3C3C58 0%, #2c2c40 60%, #3C3C58 100%)' }} > <div className="rounded-[28px] border border-black/30 p-6 md:p-8"> <div className="grid grid-cols-12 gap-6"> <div className="col-span-12 md:col-span-8 space-y-6"> <div className="relative rounded-[18px] overflow-hidden border-8 border-[#2c2c40] shadow-inner" style={{ background: 'radial-gradient(140% 120% at 50% 20%, #A7C0B0 0%, #7DA093 45%, #547a6e 100%)' }} > <div className="relative px-8 py-10 md:px-10 md:py-6" style={{ color: THEME.ink2 }}> <motion.h1 key={currentStage.k + 'title'} initial={{ opacity: 0, y: noAnimMode ? 0 : 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.35 }} className="text-3xl font-extrabold" style={{ color: THEME.dark }} > {currentStage.k} </motion.h1> <motion.p key={currentStage.k + 'text'} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.05, duration: 0.35 }} className="mt-4 text-lg leading-relaxed" > {currentStage.t} </motion.p> </div> </div> <div className="relative rounded-[18px] overflow-hidden border-8 border-[#2c2c40] shadow-inner" style={{ background: 'radial-gradient(140% 120% at 50% 20%, #e9d9c9 0%, #EAE7D6 60%, #d7d2c2 100%)' }} > <div className="relative px-6 py-6 md:px-8 md:py-6 text-[#222]"> <motion.h2 key={currentSub + 'subtitle'} initial={{ opacity: 0, y: noAnimMode ? 0 : 8 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.3 }} className="text-xl md:text-2xl font-bold" style={{ color: THEME.panelA }} > {currentSub} </motion.h2> <ul className="mt-3 grid gap-2 text-sm md:text-base"> {subItems.map((a, i) => ( <li key={i} className="flex items-start gap-2"> <span className="mt-1 w-2 h-2 rounded-full" style={{ background: THEME.green }} /> <span>{a}</span> </li> ))} </ul> </div> </div> <div className="relative rounded-[18px] overflow-hidden border shadow-inner bg-white text-[#1f1f1f] min-h-[560px]" data-snap="off"> <div className="px-6 md:px-8 py-3 border-b" style={{ borderColor: '#eadfce', background: '#fff' }}> <h3 className="text-base md:text-lg font-bold">Tactical Plan</h3> </div> <div className="px-6 py-6 md:px-8 md:py-8"> <div className="mt-0"> <div id="tabsBar" className="flex flex-wrap gap-2"> {Array.from({ length: 9 }).map((_, i) => ( <button key={i} type="button" data-tab={i} onClick={() => setActiveGoalsTab(i)} aria-pressed={activeGoalsTab === i} className="px-3 py-1.5 rounded-md text-xs font-semibold border" style={ activeGoalsTab === i ? { background: THEME.pink, color: '#fff', borderColor: THEME.pink } : { background: '#ffffff', color: THEME.mid, borderColor: '#cbbfb0' } } > {`Tab ${i + 1}`} </button> ))} </div> <div className="mt-3 rounded-lg border bg-white" style={{ borderColor: '#cbbfb0' }}> <div className="px-3 py-2 text-[11px] text-[#666] border-b" style={{ borderColor: '#eadfce' }}> {tabInfoTexts[activeGoalsTab] || `Tab ${activeGoalsTab + 1} — details for export and print.`} </div> <textarea className="screen-only w-full p-3 text-[14px] text-[#1f1f1f] rounded-b-lg outline-none" style={{ minHeight: '480px', border: 0 }} value={goalsTabs[activeGoalsTab] || ''} onChange={(e) => { const next = goalsTabs.slice(); next[activeGoalsTab] = e.target.value; setGoalsTabs(next); }} placeholder="Enter notes for this tab…" ></textarea>
                        <pre className="print-only whitespace-pre-wrap px-3 py-3 text-[14px] text-[#1f1f1f]">
                          {(goalsTabs[activeGoalsTab] && goalsTabs[activeGoalsTab].length) ? goalsTabs[activeGoalsTab] : '(no notes entered)'}
                        </pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div className="col-span-12 md:col-span-4 flex flex-col items-center justify-between pb-6">
                <div className="flex flex-col items-center w-full">
                  <p className="text-white/80 text-sm mb-2">MAIN DIAL – "NEGOTIATION STAGE"</p>
                  <motion.button
                    aria-label="Stage knob"
                    whileTap={noAnimMode ? undefined : { scale: 0.98 }}
                    onClick={next}
                    onContextMenu={(e) => { e.preventDefault(); prev(); }}
                    ref={mainDialRef}
                    className="relative w-64 h-64 rounded-full shadow-2xl focus:outline-none flex items-center justify-center"
                    style={{ background: '#7DA093', border: `6px solid ${THEME.mid}` }}
                  >
                    {Array.from({ length: mainTickCount }).map((_, i) => {
                      const a = baseAngle + i * (360 / mainTickCount);
                      const active = i === idx;
                      const h = active ? 16 : 14;
                      const dist = tickDistance('main', h);
                      return (
                        <div
                          key={i}
                          className="absolute left-1/2 top-1/2"
                          style={{ transform: `translate(-50%, -50%) rotate(${a}deg) translateY(-${dist}px)` }}
                        >
                          <div
                            className={active ? 'w-[4px] h-[16px] rounded-[2px] shadow-[0_0_6px_#A7C0B0]' : 'w-[3px] h-[14px] rounded-[2px]'}
                            style={{
                              transformOrigin: 'bottom center',
                              background: active ? '#ffffff' : '#f2f6f4',
                              boxShadow: active ? '0 0 6px rgba(255,255,255,0.9)' : 'none'
                            }}
                          />
                        </div>
                      );
                    })}
                    <div
                      className="absolute w-full h-full flex items-center justify-center"
                      style={{ transform: `rotate(${animatedMainAngle}deg)`, transition: 'transform 280ms cubic-bezier(0.22, 1, 0.36, 1)' }}
                    >
                      <div className="absolute left-1/2 top-1/2 origin-center" style={{ transform: 'translate(-50%, -50%)' }}>
                        <div className="w-[6px] h-[90px] bg-[#D1735A] rounded-full" style={{ transformOrigin: 'bottom center', transform: 'rotate(0deg) translateY(-45px)' }} />
                        <div className="absolute left-1/2 top-1/2 w-[14px] h-[14px] bg-[#D1735A] rounded-full" style={{ transform: 'translate(-50%, -50%)' }} />
                      </div>
                    </div>
                    <div className="absolute w-[60px] h-[60px] rounded-full shadow-inner" style={{ background: '#2f2f2f' }} />
                  </motion.button>
                  <div className="mt-2 text-center text-xs font-bold text-red-500 italic">
                    *Click Dial to Toggle*
                  </div>

                  <p className="text-white/80 text-sm mt-10 mb-2">SECOND DIAL – "GUIDANCE NOTES"</p>
                  <motion.button
                    aria-label="Sub knob"
                    whileTap={noAnimMode ? undefined : { scale: 0.98 }}
                    onClick={nextSub}
                    onContextMenu={(e) => { e.preventDefault(); prevSub(); }}
                    ref={subDialRef}
                    className="relative w-56 h-56 rounded-full shadow-2xl focus:outline-none flex items-center justify-center"
                    style={{ background: '#EAE7D6', border: `6px solid ${THEME.mid}` }}
                  >
                    {Array.from({ length: subTickCount }).map((_, i) => {
                      const a = baseAngle + i * (360 / subTickCount);
                      const active = i === subIdx;
                      const h = active ? 16 : 14;
                      const dist = tickDistance('sub', h);
                      return (
                        <div
                          key={i}
                          className="absolute left-1/2 top-1/2"
                          style={{ transform: `translate(-50%, -50%) rotate(${a}deg) translateY(-${dist}px)` }}
                        >
                          <div
                            className={active ? 'w-[4px] h-[16px] rounded-[2px] shadow-[0_0_6px_#A7C0B0]' : 'w-[3px] h-[14px] rounded-[2px]'}
                            style={{
                              transformOrigin: 'bottom center',
                              background: active ? '#A7C0B0' : '#7DA093',
                              boxShadow: active ? '0 0 6px #A7C0B0' : 'none'
                            }}
                          />
                        </div>
                      );
                    })}
                    <div
                      className="absolute w-full h-full flex items-center justify-center"
                      style={{ transform: `rotate(${animatedSubAngle}deg)`, transition: 'transform 260ms cubic-bezier(0.22, 1, 0.36, 1)' }}
                    >
                      <div className="absolute left-1/2 top-1/2 origin-center" style={{ transform: 'translate(-50%, -50%)' }}>
                        <div className="w-[6px] h-[70px] bg-[#D1735A] rounded-full" style={{ transformOrigin: 'bottom center', transform: 'rotate(0deg) translateY(-35px)' }} />
                        <div className="absolute left-1/2 top-1/2 w-[12px] h-[12px] bg-[#D1735A] rounded-full" style={{ transform: 'translate(-50%, -50%)' }} />
                      </div>
                    </div>
                    <div className="absolute w-[50px] h-[50px] rounded-full shadow-inner" style={{ background: '#2f2f2f' }} />
                  </motion.button>
                  <div className="mt-2 text-center text-xs font-bold text-red-500 italic">
                    *Click Dial to Toggle*
                  </div>

                  <div className="mt-16 flex flex-wrap gap-2 justify-center">
                    <button
                      onClick={handleExportPDF}
                      data-snap="off"
                      className="px-4 py-2 rounded-md font-semibold text-white hover:opacity-90"
                      style={{ background: THEME.pink }}
                    >
                      Export to PDF
                    </button>
                    <button
                      onClick={onExportJSON}
                      className="px-4 py-2 rounded-md font-semibold text-white hover:opacity-90"
                      style={{ background: '#3b82f6' }}
                      title="Export Strategy Data and Tactical Plan tabs as a JSON file"
                    >
                      Save session
                    </button>
                    <button
                      onClick={onStartImportJSON}
                      className="px-4 py-2 rounded-md font-semibold text-white hover:opacity-90"
                      style={{ background: '#d97706' }}
                      title="Import previously saved JSON to restore all tabs"
                    >
                      Retrieve previous data
                    </button>
                  </div>

                  <div
                    className="mt-6 w-full rounded-lg border-2 p-4 text-sm space-y-3"
                    style={{ borderColor: '#ef4444', minHeight: '180px' }}
                  >
                    <p className="m-0">(1) The Main dial is to select one of the five stages of negotiation for which guidance is needed.</p>
                    <p className="m-0">(2) The second dial is to select the guidance notes under each of the five negotiation stages.</p>
                    <p className="m-0">(3) The Tactical Plan is to be prepared based on the guidance under: "Main Dial – 1. Preparation" and "Second Dial – A. to J." guidance notes.</p>
                    <p className="m-0">(4) The other dials are to guide users in their thinking on negotiation best practices.</p>
                  </div>

                  <div className="mt-3 w-full text-center font-bold text-yellow-300">
                    ** Version 1.0 made by NSKS/14106803/Jul25/A2 **
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            className="absolute -bottom-3 left-6 right-6 h-3 rounded-b-[18px]"
            style={{ background:'rgba(0,0,0,0.3)' }}
          />
        </div>
      </div>
    );
  }

  function NegotiationDashboard() {
    const initial = [
      {
        k: '1. Preparation',
        t: 'Define objectives. Perform due diligence and set a clear agenda - helps in Reducing Information asymmetry and mitigate the risk of making mistakes.',
        subs: {
          'A. Identify Type Of Negotiation': [
            'Is this a Single / Multiple party negotiation?',
            'Is this an Integrative / Distributive negotiation?',
            'Is this a Monetary / Mixed type of negotiation?',
          ],
          'B. BATNA, ZOPA & Reservation Value': [
            'Write your BATNA in one line.',
            'Quantify your ZOPA and Reservation value.',
            'Plan if, when and how to disclose BATNA.',
          ],
          'C. Stakeholders & Power': [
            'List all decision-makers and influencers.',
            'Identify who holds real power.',
            'Prepare tailored benefit messages.',
          ],
          'D. Team & Roles': [
            'Assign Chairperson, Lead, Summariser, Observer and Specialist.',
            'Confirm each member’s talking points.',
            'Agree on directive to stay coordinated.',
          ],
          'E. Goals & Success Criteria': [
            'Define SMART goals for the negotiation.',
            'Separate must-haves from tradeables.',
            'List expected measurable outcomes.',
          ],
          'F. Interest Matrix & Assumptions': [
            'Prepare a detailed Interest Matrix (Beware of Positions!).',
            'Look at firm and individual level interests.',
            'List out assumptions for validation during negotiation.',
          ],
          'G. Boundary Tests & Value Creation': [
            'Identify how far each party can go.',
            'Identify possible outcomes.',
            'Identify all value creation and capturing possibilities.',
          ],
          'H. Analyse Relationships At Play': [
            'Understand relationship dynamics.',
            'Define reputational risks and leverage opportunities.',
            'Understand emotions at play.',
          ],
          'I. Assess your Leverage': [
            'How do you perceive your position?',
            'Is your Strategy aligned?',
            'Is there a means to validate your position?',
          ],
          'J. Build a Tactical Plan': [
            'Use tactical plan section below.',
            'Stick to the agenda',
            'Add maximum information and identify potential blockers',
          ],
        },
      },
      {
        k: '2. Information Exchange',
        t: 'Build rapport, surface interests, manage information asymmetry, and signal credibly.',
        subs: {
          'A. Rapport & Tone': [
            'Open with professional warmth.',
            'Acknowledge common interests.',
            'Keep tone calm and collaborative.',
            'Avoid threatening language / leave ego at the door.',
          ],
          'B. Diagnostic Questions': [
            'Ask open-ended ‘why’ and ‘how’ questions.',
            'Probe constraints without judgment.',
            'Summarise answers to show understanding.',
          ],
          'C. Signaling & Screening': [
            'Share one safe fact to build trust.',
            'Observe verbal and non-verbal signals.',
            'Verify key information before relying on it.',
          ],
          'D. Trust & Pace': [
            'Acknowledge their points clearly.',
            'Slow down if tone becomes defensive.',
            'Use pauses strategically to encourage sharing.',
          ],
        },
      },
      {
        k: '3. Developing Strategy',
        t: 'Key understanding for strategy building - perceived conflict over stakes, perceived leverage, style & type of negotiation.',
        subs: {
          'A. MESO Design': [
            'Create 3 equivalent package offers.',
            'Score each by cost and benefit.',
            'Record responses to learn priorities.',
          ],
          'B. Anchors & First Offer': [
            'Make the first offer only if you have solid data.',
            'Use precise numbers for credibility.',
            'Prepare counter-anchor phrases.',
          ],
          'C. Framing & Influence': [
            'Influence - Consistency, Consensus, Authority, Similarity, Reciprocity, Scarcity.',
            'Allocate sufficient time to establish context and framing.',
            'Frame negotiation in terms of interests, not positions / consider cultural factors.',
            'Think of the Goals, Rights, Interests and Power / Avoid biases.',
          ],
          'D. Concession Plan & Salami Tactics': [
            'Trade in small increments.',
            'Ask for reciprocity on every give.',
            'Note all agreed concessions in writing.',
          ],
          'E. Contingency Contracts': [
            'Have contingency clauses ready for addition to contract (if needed).',
            'Practice a risk-based approach.',
            'Use contingency contracts to clarify uncertainty (eg. lies, ignorance).',
          ],
          'F. Investigative Negotiation': [
            'Ask "Why?" not "What?" and seek to reconcile interests, not demands.',
            'Create common ground and interpret demands as opportunities.',
            "Dont dismiss anything as “their” problem.",
            'Understand the difference between selling and negotiating.',
          ],
          'G. Value Creation & Distribution': [
            'Use differences to create value for all parties.',
            "Dont have a rigid focus on price alone.",
            'Leverage your Distinct Value Prop (DVP).',
            'Ensure both parties capture value that is important to them.',
          ],
          'H. Build Trust': [
            'Balance Empathy and assertiveness.',
            'Be realistic, do not lie, come up with externally provable info and data.',
            "Look to meet the other party’s interests, and tell them clearly!.",
            'Leave the negotiation with a better relationship.',
          ],
          'I. Difficult Box': [
            'Set guardrails early.',
            'Name and neutralise tactics.',
            'Protect leverage.',
          ],
          'J. Communication': [
            'What do we want to learn from them / how can we improve listening?',
            'What do we want to communicate and how to do this more persuasively?',
            'What is the agenda?, What negotiation approach would we use?',
            'How will we handle inevitable disagreements?',
          ],
        },
      },
      {
        k: '4. Closing & Gaining Commitment',
        t: 'Trade smartly, summarise plainly, confirm commitments, timelines, and documentation.',
        subs: {
          'A. Trading Questions': [
            'Ask: What’s it worth to them?',
            'Ask: What’s the cost to me?',
            'Plan: what you want in return.',
          ],
          'B. Summarise & Confirm': [
            'Restate key points in plain language.',
            'Confirm agreement on each issue.',
            'Get verbal ‘yes’ before final sign-off.',
          ],
          'C. Commitments & Timelines': [
            'List who will do what by when.',
            'Document milestones and dependencies.',
            'Share final checklist in writing for follow-up.',
            'Avoid over commitment and ultimatums.',
          ],
          'D. Nibble Defence': [
            'Politely decline ("I can\'t") last-minute extras (10$ shuffle).',
            'Swap any add-ons for equal value.',
            'Close firmly once all terms are settled.',
          ],
        },
      },
      {
        k: '5. Review',
        t: 'Evaluate outcomes and process, capture lessons, and reset plans for next round.',
        subs: {
          'A. Outcome vs Objectives': [
            'Compare results with original goals.',
            'Score value created vs captured.',
            'Note unexpected wins or losses.',
          ],
          'B. Bias & Process': [
            'Identify emotional or anchoring bias.',
            'Record missed signals.',
            'Rate team coordination objectively.',
          ],
          'C. Lessons & Playbook': [
            'Write three (3) takeaways for next time.',
            'Update your negotiation template (Negotiation Machine).',
            'Share lessons with your team.',
          ],
          'D. Renegotiation Plan': [
            'Define triggers for reopening talks.',
            'Add items for future value creation.',
            'Schedule review or follow-up meeting.',
          ],
        },
      },
    ];

    const { stages, setStages, updateStage, renameSub, updateSubItems } = useStrategyData(initial);
    const [view, setView] = React.useState('machine');
    const [goalsTabs, setGoalsTabs] = React.useState(Array(9).fill(''));

    React.useEffect(() => {
      window.__reactGetGoalsTabs = () => goalsTabs;
      return () => { delete window.__reactGetGoalsTabs; };
    }, [goalsTabs]);

    const fileInputRef = React.useRef(null);
    const schemaVersion = 1;

    function serializeData() {
      return { app: "NegotiationMachine", schemaVersion, savedAt: new Date().toISOString(), stages, goalsTabs };
    }

    function applyImportedData(payload) {
      if (!payload || payload.app !== "NegotiationMachine") throw new Error("Unrecognized file/app tag");
      if (typeof payload.schemaVersion !== "number" || payload.schemaVersion < 1) throw new Error("Unsupported schema version");
      if (!Array.isArray(payload.stages) || !Array.isArray(payload.goalsTabs)) throw new Error("Invalid data shape");
      setStages(payload.stages);
      setGoalsTabs(payload.goalsTabs);
    }

    const exportJSON = React.useCallback(async () => {
      try {
        const data = serializeData();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const suggested = "negotiation_machine_data_" + new Date().toISOString().replace(/[:.]/g, "-") + ".json";

        if (window.showSaveFilePicker) {
          try {
            const handle = await window.showSaveFilePicker({
              suggestedName: suggested,
              types: [{ description: "JSON Files", accept: { "application/json": [".json"] } }]
            });
            const w = await handle.createWritable();
            await w.write(blob);
            await w.close();
            return;
          } catch (e) {
            if (!e || e.name === "AbortError") return;
            console.warn("saveFilePicker failed, using anchor fallback:", e);
          }
        }
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = suggested;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (e) {
        console.error(e);
        alert("Export failed: " + (e && e.message ? e.message : String(e)));
      }
    }, [stages, goalsTabs]);

    function startImportJSON() { if (fileInputRef.current) fileInputRef.current.click(); }

    async function handleImportJSON(e) {
      try {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        const text = await f.text();
        const parsed = JSON.parse(text);
        applyImportedData(parsed);
        alert("Data imported successfully.");
      } catch (err) {
        console.error(err);
        alert("Import failed: " + (err && err.message ? err.message : String(err)));
      } finally {
        if (fileInputRef.current) fileInputRef.current.value = "";
      }
    }

    return (
      <div className="min-h-screen w-full text-white"
           style={{ background: 'linear-gradient(145deg,#3C3C58 0%, #2c2c40 60%, #3C3C58 100%)' }}>

        <input
          ref={fileInputRef}
          type="file"
          accept="application/json,.json"
          onChange={handleImportJSON}
          className="hidden"
        />

        <div className="w-full max-w-6xl mx-auto px-4 py-4 flex gap-3">
          <button onClick={() => setView('machine')} className="px-4 py-2 rounded-xl font-semibold shadow"
                  style={{ background: view==='machine'?THEME.pink:THEME.panelA }}>
            NEGOTIATION MACHINE
          </button>
          <button onClick={() => setView('strategy')} className="px-4 py-2 rounded-xl font-semibold shadow"
                  style={{ background: view==='strategy'?THEME.green:THEME.panelA }}>
            STRATEGY DATA
          </button>
        </div>

        {view === 'machine' ? (
          <NegotiationMachineRetroTV
            stages={stages}
            goalsTabs={goalsTabs}
            setGoalsTabs={setGoalsTabs}
            onExportJSON={exportJSON}
            onStartImportJSON={startImportJSON}
          />
        ) : (
          <div className="pb-16">
            <p className="text-center text-sm text-white/80 mt-2">
              Update stages and subtopics here. Changes are reflected in the Negotiation Machine.
            </p>
            <StrategyEditor
              stages={stages}
              updateStage={updateStage}
              renameSub={renameSub}
              updateSubItems={updateSubItems}
            />
            <div className="w-full max-w-6xl mx-auto px-4 mt-3 flex flex-wrap gap-2">
              {/* Export/Import moved to Machine view */}
            </div>
          </div>
        )}
      </div>
    );
  }

  function buildPrintDump(tabs, titles) {
    const c = document.createElement('div');
    c.className = 'print-dump';
    c.style.cssText = 'background:#ffffff;color:#000000;padding:16px;margin:16px;border:1px solid #ddd;border-radius:8px;';
    let html = '<div style="font-weight:700;font-size:16px;margin-bottom:10px">Negotiation Machine — Tabs</div>';
    for (let i = 0; i < tabs.length; i++) {
      const raw = tabs[i] || '(no notes entered)';
      const safe = String(raw).replace(/[&<>]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]));
      const label = titles && titles[i] ? String(titles[i]).trim() : 'Tab ' + (i + 1);
      html += '<div style="border:1px solid #e5e7eb;border-radius:6px;padding:10px;margin-bottom:10px;background:#fafafa">';
      html +=   '<div style="font-weight:600;margin-bottom:6px">' + label + '</div>';
      html +=   '<pre style="white-space:pre-wrap;margin:0;font-size:13px;line-height:1.35">' + safe + '</pre>';
      html += '</div>';
    }
    c.innerHTML = html;
    return c;
  }

  (function attachPrintHooks(){
    let dump = null;
    window.addEventListener('beforeprint', function(){
      try {
        const getter = window.__reactGetGoalsTabs;
        if (typeof getter === 'function') {
          const tabs = getter();
          if (Array.isArray(tabs)) {
            const titles = window.__tabInfoTexts || null;
            dump = buildPrintDump(tabs, titles);
            document.body.appendChild(dump);
          }
        }
      } catch (e) { /* no-op */ }
    });

    window.addEventListener('afterprint', function(){
      try {
        if (dump && dump.parentNode) dump.parentNode.removeChild(dump);
      } finally {
        dump = null;
      }
    });
  })();

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<NegotiationDashboard />);
}

</script> </body> </html>